{% extends 'Portal/base.html' %}
{% load user_tags %}
{% load static %}

{% block body %}
<section class="container text-center mt-5">
    <div class="row pb-5">

        <div class="col-sm-12">

            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item active" aria-current="page"><a href="{% url 'Portal:index' %}">Portal</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">Events</li>
                    <li class="breadcrumb-item active" aria-current="page">Overview</li>
                </ol>
            </nav>


            <div>
                <form method="post">
                    {% csrf_token %}
                    <div class="controls">

                        <div class="control">
                            <!--Selection-->
                            <!--<div class="form-check">-->
                            <!--<input class="form-check-input" type="checkbox" name="selectAll" value=""-->
                            <!--id="selectAll">-->
                            <!--<label class="form-check-label" for="selectAll">Select/deselect all</label>-->
                            <!--</div>-->

                            <!--Action-->
                            <div id="actions">
                                <select name="action" id="action" class="custom-select custom-select-md"
                                        aria-label="Which action should be taken?">
                                    {% for action, value in actions.items %}
                                    <option value="{{value}}">{{action}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="perform">
                            <button class="btn btn-primary" type="submit">Perform action</button>
                        </div>

                    </div>

                    <div id="divider" class="mt-3"></div>

                    <div id="events">
                        <table class="table table-striped table-hover events-table">


                            <thead class="thead">
                            <tr>
                                <th class="checkbox-col" scope="col">
                                    <input onchange="toggleAll()" type="checkbox" name="selectAll" value=""
                                           id="selectAll">
                                </th>
                                <th scope="col" class="th-xs">ID</th>
                                <th scope="col" class="th-lg">Name</th>
                                <th scope="col" class="th-sm">Start</th>
                                <th scope="col" class="th-sm">End</th>

                                <th scope="col" class="th-xs smol">Visible</th>
                                <th scope="col" class="th-xs"></th>
                            </tr>
                            </thead>

                            <tbody>
                            {% for event in events %}
                            <tr id="{{event.pk}}" onclick="location.href='{% url 'Portal:event' event.pk %}'">
                                <td class="checkbox-col">
                                    <input onchange="toggleSelected({{event.pk}})" class="checkbox" type="checkbox"
                                           name="checkbox" value="{{event.pk}}">
                                </td>
                                <td>{{event.pk}}</td>
                                <td>{{event.name}}</td>
                                <td>{{event.start}}</td>
                                <td>{{event.end}}</td>


                                <td>
                                    <p>{% if event.is_visible %}Yes {% else %}No {% endif %}</p>
                                </td>
                                <td></td>
                            </tr>
                            {% endfor %}
                            </tbody>

                        </table>
                    </div>


                </form>
            </div>

        </div>
    </div>
</section>
<style>
    .card {
        background-image: url({{ urls|lookup:'portal_card' }})
    }






</style>
<script type="application/javascript">
    function toggleSelected(id){
        const toggle = $(`#${id}`)
        toggle.toggleClass('table-warning')
        checkForSelectAll()
    }

    function toggleAll(){
        const newChecked = $('#selectAll')[0].checked
        let boxes = $('.checkbox')
        boxes.each(function(){
            if($(this)[0].checked !== newChecked)
                $(this).closest('tr').toggleClass('table-warning')
        })
        boxes.prop('checked', !!newChecked)
        checkForSelectAll()
    }

    function checkForSelectAll(){
        $('#selectAll').prop('checked', $('.checkbox').toArray().every(s=> s.checked))
    }






</script>

{% endblock %}
